# Sea-Saw CRM Gateway - Reverse Proxy Only
#
# This compose file ONLY contains the nginx gateway service.
# It connects to existing backend and frontend services via shared Docker network.
#
# Prerequisites:
# 1. Backend services must be running (from sea-saw-server repo)
# 2. Frontend service must be running (from sea-saw-app repo)
# 3. Shared network 'sea-saw-network' must exist
#
# Service Discovery:
# - Backend API: http://sea-saw-backend:8000 (container name from backend compose)
# - Frontend: http://sea-saw-frontend (container name from frontend compose)

services:
  gateway:
    image: hkccr.ccs.tencentyun.com/sea-saw/gateway:latest
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sea-saw-gateway
    volumes:
      # Mount static and media files from backend using external volumes
      - backend_static:/home/app/web/staticfiles:ro
      - backend_media:/home/app/web/mediafiles:ro
    ports:
      - "80:80"
      # - "443:443"  # Uncomment for SSL
    healthcheck:
      test: ["CMD", "curl", "-f", "-s", "http://localhost/health/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    networks:
      - sea-saw-network

# External volumes created by backend services
volumes:
  backend_static:
    external: true
    name: sea-saw-backend-static
  backend_media:
    external: true
    name: sea-saw-backend-media

# External network shared with all services
networks:
  sea-saw-network:
    external: true
    name: sea-saw-network
